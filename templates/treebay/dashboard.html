{% extends 'treebay/base.html' %}
{% load staticfiles %}

{% block scripting %}
    <script>
        // Show alerts from edit account actions on window load
        window.onload=showAlerts;

        // Toggle between hiding and showing the dropdown contents on each click
        function toggle() {
          document.getElementById("myDropdown").classList.toggle("show");
        }

        // Close the dropdown if the user clicks outside of it
        window.onclick = function(event) {
          if (!event.target.matches('.dropbtn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        };

        function hideSmIfEmpty( table ){
            if( typeof $("tbody tr:not(tr.visible)",table).first().attr('class') === 'undefined' ){
                $("tfoot tr",table).hide();
            }
        }

        function navToA( a ){
            window.location.href = a.attr("href");
        }

        $(document).ready( function(){
            $("tr.vt0").addClass("visible");

            $("a.tableexpand").each( function() {
                hideSmIfEmpty( $(this).parents("table.expandingadtable") );
            });

            $("a.tableexpand").click( function(e) {
                e.preventDefault();
                var parent = $(this).parents("table.expandingadtable");
                var firstunclass = $("tbody tr:not(tr.visible)",parent).first().attr('class');
                $("tr."+firstunclass,parent).addClass("visible");
                hideSmIfEmpty(parent);
            });

            $("div.largebutton").click( function(){
                navToA($("a",this));
            });

            $("div.largebutton a").click( function(e){
                e.preventDefault();
                navToA($(this));
            });
        });
    </script>
{% endblock %}

{% block title_block %}
         - Dashboard
{% endblock %}

{% block main_body %}
    <div id="sellerinfo">
        <img src="{% if user.profile.picture %}{{ user.profile.picture.url }}{% else %}{% static 'img/svg/default_profile_picture.svg' %}{% endif %}" />
        <h2>{{ user.username }}</h2>
        <p>Member since<br/>{{ user.date_joined.date }}</p>
        <div class="dropdown">
          <button onclick="toggle()" class="dropbtn">&#9998; Edit</button>
          <div id="myDropdown" class="dropdown-content">
            <a href="{% url 'treebay:edit_profile' %}">Edit profile details</a>
            <a href="{% url 'treebay:change_password' %}">Change password</a>
            <a href="{% url 'treebay:delete_profile' %}">Delete profile</a>
          </div>
        </div>
    </div>

    <h4 class="ditemhead">Adverts</h4>

    <div id="dashadframe" class="dashelmnt">
        <table class="expandingadtable">
            <thead>
                <tr>
                    <th colspan=2>My Adverts</th>
                </tr>
            </thead>
            <tbody>
                <!-- vt(view trigger)0 objects will be shown on first load,
                        other vt's are used to group the other objects to
                        load each expansion after. They do not need to be in
                        order, the function will make "all objects of the next
                        (layout-wise) non-visible class type in the
                        expandingadtable" visible. -->

                {% for plnt in plants %}
                <tr class="vt{{plnt.viewtrigger}}">
                    <td><a href="TODO">{{plnt.name}}</a></td>
                    <td>
					{% if plnt.stars >= hot %}<span class="labelhot">&#128901;</span>
					{% elif plnt.isSold %}<span class="labelsold">&#9651;</span>
					{% else %}<span class="labelactive">&#9634;</span>
					{% endif %}
					</td>
                </tr>
				{% empty %}
				<tr class="visible">
					<td colspan=2><center>- None -</center></td>
				</tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan=2><a href=":)" class="tableexpand">See more...</a></td>
                </tr>
            </tfoot>
        </table>

        <table class="expandingadtable">
            <thead>
                <tr>
                    <th colspan=2>Starred</th>
                </tr>
            </thead>
            <tbody>
                {% for plnt in starred %}
                <tr class="vt{{plnt.viewtrigger}}">
                    <td><a href="TODO">{{plnt.name}}</a></td>
					
					<td>
					{% if plnt.stars >= hot %}<span class="labelhot">&#128901;</span>
					{% elif plnt.isSold %}<span class="labelsold">&#9651;</span>
					{% endif %}
					</td>
					
                </tr>
				{% empty %}
				<tr class="visible">
					<td colspan=2><center>- None -</center></td>
				</tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan=2><a href=":)" class="tableexpand">See more...</a></td>
                </tr>
            </tfoot>
        </table>
		
		{# Doesn't do anything, but doesn't work without... and we dont know why #}
		<br />

        <div id="dashadrightpannel">

            <table>
                <thead>
                    <tr>
                        <th colspan=2>
                            Legend
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="labelhot">&#128901;</span></td>
                        <td> - Hot</td>
                    </tr>
                    <tr>
                        <td><span class="labelactive">&#9634;</span></td>
                        <td> - Active</td>
                    </tr>
                    <tr>
                        <td><span class="labelsold">&#9651;</span></td>
                        <td> - Sold</td>
                    </tr>
                </tbody>
            </table>

            <div class="largebutton">
                <a href="">New Advert</a>
            </div>
        </div>
    </div>
{% endblock %}